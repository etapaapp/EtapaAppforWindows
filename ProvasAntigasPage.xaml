<Page
    x:Class="EtapaApp.ProvasAntigasPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:EtapaApp"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="Page_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Barra superior com botão voltar e pesquisa -->
        <Grid x:Name="TopToolbar" Grid.Row="0" Margin="12,12,12,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Botão Voltar -->
            <Button x:Name="BackButton"
                    Grid.Column="0"
                    Click="BackButton_Click"
                    IsEnabled="False"
                    Margin="0,0,8,0"
                    VerticalAlignment="Center"
                    ToolTipService.ToolTip="Voltar ao diretório anterior">
                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE72B;" FontSize="16"/>
            </Button>

            <!-- Barra de pesquisa -->
            <AutoSuggestBox x:Name="SearchBox"
                            Grid.Column="1"
                            PlaceholderText="Buscar provas..."
                            QueryIcon="Find"
                            VerticalAlignment="Center"
                            TextChanged="SearchBox_TextChanged"/>
        </Grid>

        <!-- Conteúdo principal -->
        <Grid Grid.Row="1">
            <!-- Lista de itens (pastas e arquivos) -->
            <ListView x:Name="ItemsListView"
                      Margin="12,0,12,12"
                      SelectionMode="None"
                      IsItemClickEnabled="True"
                      ItemClick="ItemsListView_ItemClick"
                      Background="{ThemeResource LayerFillColorDefaultBrush}"
                      CornerRadius="8">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="12,8"
                              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                              Margin="4,2"
                              CornerRadius="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Nome do item -->
                            <TextBlock Grid.Column="0"
                                       Text="{Binding Name}"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                       TextTrimming="CharacterEllipsis"/>

                            <!-- Indicador de tipo -->
                            <TextBlock Grid.Column="1"
                                       Text="{Binding TypeDescription}"
                                       VerticalAlignment="Center"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="8,0,0,0"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Background" Value="Transparent"/>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>

            <!-- Indicador de carregamento -->
            <ProgressRing x:Name="LoadingRing"
                          Width="40"
                          Height="40"
                          IsActive="False"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"/>

            <!-- InfoBar para mensagens de download (no topo da página) -->
            <InfoBar x:Name="StatusBar"
                     IsOpen="False"
                     Title="Status"
                     Severity="Informational"
                     VerticalAlignment="Top"
                     HorizontalAlignment="Stretch"
                     Margin="12"
                     Grid.Row="0"
                     Grid.RowSpan="2"/>

            <!-- Placeholder quando não há itens -->
            <StackPanel x:Name="EmptyFolderPanel"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="Collapsed"
                        Spacing="12">
                <TextBlock Text="Esta pasta está vazia"
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Não há provas disponíveis neste diretório"
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- Painel de erro centralizado -->
            <Border x:Name="ErrorPanel"
                    Background="{ThemeResource SystemFillColorCriticalBackgroundBrush}"
                    BorderBrush="{ThemeResource SystemFillColorCriticalBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MaxWidth="400"
                    Visibility="Collapsed"
                    Padding="24">
                <StackPanel Spacing="16">
                    <!-- Ícone de erro -->
                    <FontIcon FontFamily="Segoe MDL2 Assets" 
                              Glyph="&#xE783;" 
                              FontSize="32"
                              HorizontalAlignment="Center"
                              Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>

                    <TextBlock x:Name="ErrorTitleText"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"
                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                    <TextBlock x:Name="ErrorMessageText"
                               Style="{StaticResource BodyTextBlockStyle}"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"
                               TextWrapping="Wrap"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>